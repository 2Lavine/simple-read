# 深入认识setState

setState，它对状态的改变，**可能**是异步的

如果改变状态的代码处于某个HTML元素的事件中，则其是异步的，否则是同步

- 如在 click 事件的回调函数中他是异步的
- 而在setTimeout的回调函数中是同步的

```
this.setState({
 n:this.state.n+1
})
this.setState({
 n:this.state.n+1
})
```

上面的代码是异步执行的，因此 两次执行的 setState 等价于

```js
this.setState({
 n:0+1
})
this.setState({
 n:0+1
})
```



## 最佳实践：

1. 把所有的setState当作是异步的
2. 永远不要信任setState调用之后的状态
3. 如果要使用改变之后的状态，需要使用回调函数（setState的第二个参数）
4. 如果新的状态要根据之前的状态进行运算，使用函数的方式改变状态（setState的第一个函数）

React会对异步的setState进行优化，

- 即对将同一浏览器事件内的 setState 进行优化

- 将多次setState进行合并（将多次状态改变完成后，再统一对state进行改变，然后触发render）
- 回调函数也在合并执行完成之后执行

