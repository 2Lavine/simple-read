> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [juejin.cn](https://juejin.cn/post/7199812069050171452)

ä¸ºä½•è¦ä½¿ç”¨ `ISR` ï¼Ÿ
-------------
å…ˆåˆ†äº«ä¸€ä¸‹ä¸ºä½•è¦ä½¿ç”¨ `ISR` ï¼Œå¯èƒ½æœ‰äººè¿˜ä¸æ˜¯å¾ˆç†è§£è¿™ä¸ª `ISR` æ˜¯ä»€ä¹ˆã€‚
Next.JS é¡¹ç›®æ‰“åŒ…æ—¶ï¼Œä½¿ç”¨ `getStaticProps` æˆ–è€…ä¸ä½¿ç”¨ `Date Fetch` å‡½æ•°çš„é¡µé¢ä¼šé»˜è®¤ [`é™æ€åŒ–`](https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fbasic-features%2Fpages%23static-generation "https://nextjs.org/docs/basic-features/pages#static-generation") ï¼Œä¹Ÿå°±æ˜¯ä¼šç”Ÿæˆ`[pageName].html` çš„ html æ–‡ä»¶ï¼Œç”¨æˆ·è®¿é—®å°±å Next æœåŠ¡ç›´æ¥è¯»å–æ­¤ html æ–‡ä»¶ï¼Œä¸å†å»åŠ¨æ€æ¸²æŸ“å†…å®¹ï¼Œä¹Ÿå°±å‡å°‘äº†æ¥å£çš„è¯·æ±‚ï¼Œ

å› æ­¤ï¼Œç›¸æ¯” `SSR` æ¸²æŸ“æ¨¡å¼ï¼Œèƒ½æå¤§çš„å‡å°‘é¡µé¢è®¿é—®æ—¶é—´ï¼ˆå¤§éƒ¨åˆ†é¡µé¢åœ¨æ­£å¸¸ç½‘é€Ÿèƒ½æ§åˆ¶åœ¨ 1s å†…æ˜¾ç¤ºï¼‰å’Œé™ä½æœåŠ¡å™¨çš„å‹åŠ›ã€‚


---
ä½¿ç”¨ `getStaticProps` çš„é™æ€åŒ–é¡µé¢ä¼šå¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼Œæ¥å£å†…å®¹æ›´æ–°åï¼Œç”¨æˆ·è®¿é—®é¡µé¢è·å–åˆ°çš„ä¿¡æ¯å¹¶ä¸ä¼šæ›´æ–°ï¼Œå› æ­¤éœ€è¦ä¸€ç§å¯ä»¥åœ¨æœåŠ¡è¿è¡Œä¸­åŠ¨æ€å»è§¦å‘ SSG ç”Ÿæˆçš„ html çš„èƒ½åŠ›ï¼Œäºæ˜¯å°±å‡ºç°äº† `ISR`ï¼Œè®© `SSG` ä¹Ÿèƒ½æ‹¥æœ‰å¢é‡æ›´æ–°çš„èƒ½åŠ›ã€‚

å¢é‡é™æ€åŒ–
-------
å¢é‡é™æ€åŒ–ä¸€èˆ¬æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š`å®šæ—¶æ›´æ–°` å’Œ `æŒ‡ä»¤æ›´æ–°`ã€‚

### ISR â€”â€” å®šæ—¶æ›´æ–°

æ–°å»ºé¡µé¢ï¼š
```
// src/pages/isr/demo1/index.js
const Demo1 = ({ times }) => {
  return (
    <div>
      <h2>å®šæ—¶åˆ·æ–°</h2>
      <div>åˆ·æ–°æ¬¡æ•°ï¼š{times}</div>
    </div>
  )
}

let times = 0;

export async function getStaticProps() {
  times += 1
  console.log(times)
  return {
    props: {
      times,
    },
    revalidate: 10, // 10ç§’åè®¿é—®è§¦å‘æ›´æ–°
  }
}
```

å¼€å‘ç¯å¢ƒ `é™æ€åŒ–` è¡¨ç°å’Œ `ssr` ä¸€æ ·ï¼Œå› æ­¤ï¼Œéœ€è¦éœ€è¦æ‰“åŒ…åè¿è¡Œæ‰èƒ½çœ‹å‡ºæ•ˆæœï¼Œè¿è¡Œ build å‘½ä»¤ï¼š
```
# æ„å»ºæ‰“åŒ…
pnpm build
```

æ„å»ºè¿‡ç¨‹ä¸­ä¼šæ‰“å° `1` 
`.next/server/pages/isr` ç›®å½•ä¸‹å·²ç»ç”Ÿæˆäº†ä¸€ä¸ª demo1 çš„ html æ–‡ä»¶ï¼Œæ³¨æ„è¿™æ—¶å€™ `times` ä¸º `1` ã€‚
`pnpm start` å¯åŠ¨å·¥ç¨‹åè®¿é—® demo1 é¡µé¢,vscode çš„æ§åˆ¶å°æ‰“å°è¾“å‡ºä¸º`1`ï¼ˆbuild å’Œ start éƒ½ä¼šé‡æ–°åˆå§‹åŒ– timesï¼‰ï¼Œè¿™æ—¶å€™ä¼šè§¦å‘æ„å»º;

æ„å»ºå®Œæˆä¹‹åï¼Œå†æ¬¡è®¿é—®ä¼šå‘ç°è·Ÿé¦–æ¬¡è®¿é—®ä¸€æ ·çš„ï¼Œä¸Šé¢æ˜¾ç¤ºçš„åˆ·æ–°æ¬¡æ•°è¿˜æ˜¯ `1` ï¼Œä½†æ˜¯ vscode çš„æ§åˆ¶å°å°è¾“å‡ºä¸º`2` ï¼Œè¿™æ˜¯å› ä¸ºè®¿é—®çš„æ—¶å€™æ˜¯å»æ„å»ºæ–°çš„é¡µé¢ï¼Œä»ç„¶è¿”å›ä¸Šä¸€æ¬¡æ„å»ºæˆåŠŸçš„é¡µé¢å†…å®¹ï¼Œå¹¶ä¸ä¼šè¿”å›å½“å‰æ­£åœ¨æ„å»ºçš„å†…å®¹ã€‚

ä»¥åæ¯æ¬¡è®¿é—®æ—¶ï¼Œæ§åˆ¶å°æ‰“å°çš„æ•°å­—éƒ½ä¼šæ¯”æ­£åœ¨æ˜¾ç¤ºçš„å¤§ã€‚
ä¸Šé¢çš„è¿™ç§ç°è±¡ä¹Ÿèƒ½è¯´æ˜å®˜æ–¹æ–‡æ¡£ä¸Šé˜è¿°çš„ä¸€ä¸ªç»“è®ºï¼šå½“å‘å‡ºè¯·æ±‚è®©é¡µé¢è¿›è¡Œæ„å»ºæ—¶ï¼Œå®ƒä¼šå…ˆè¿”å›ç¼“å­˜é¡µé¢ã€‚

### ISR â€”â€” æŒ‡ä»¤æ›´æ–°

```
// src/pages/isr/demo2/index.js
export async function getStaticProps() {
  times += 1
  console.log(times)
  return {
    props: {
      times,
    }
  }
}
```

æ–°å¢ä¸€ä¸ªè§¦å‘é¡µé¢æ›´æ–°çš„æ¥å£æŒ‡ä»¤ï¼š

```
// src/pages/api/revalidate.js
export default async function revalidateHandler(req, res) {
  // æŒ‡ä»¤å¯†é’¥æ ¡éªŒ
  if (req.query.secret !== MY_SECRET_TOKEN) {
    return res.status(401).json({ message: 'Invalid token' })
  }

  try {
    // æ›´æ–° demo2
    await res.revalidate('/isr/demo2')
    // è¿”å›è¯´æ˜æ›´æ–°æŒ‡ä»¤å·²å‘å‡ºï¼Œå¹¶ä¸èƒ½è¯´æ˜ä¸€å®šæ›´æ–°æˆåŠŸ
    return res.json({ revalidated: true })
  } catch (err) {
    // æ›´æ–°å¤±è´¥
    return res.status(500).send('Error revalidating')
  }
}
```

è¿è¡Œ `pnpm build && pnpm start` ï¼Œè®¿é—® `demo2` é¡µé¢ ä¸ç®¡è®¿é—®å¤šå°‘æ¬¡ï¼Œ`getStaticProps` éƒ½ä¸ä¼šè§¦å‘ï¼Œé¡µé¢ä¸Šéƒ½æ˜¾ç¤ºåˆ·æ–°æ¬¡æ•°ä¸º `1` ï¼š

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b77327c3bf24d2ba3640517b6bc0180~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

ç„¶åè®¿é—® `http://localhost:3000/api/revalidate?secret=MY_SECRET_TOKEN`ï¼Œè®¿é—®åï¼Œç”µè„‘æ§åˆ¶å°ä¼šæ‰“å° 2ï¼Œä½†å¦‚æœç«‹é©¬å¿«é€Ÿå»è®¿é—®é¡µé¢ï¼Œé¡µé¢ä¸Šæ˜¾ç¤ºåˆ·æ–°æ¬¡æ•°è¿˜ä¼šæ˜¯ `1` ï¼Œå› ä¸ºæ„å»ºè¿˜æ˜¯éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œç¨å¾®ç­‰ä¸€ä¸‹å†å»è®¿é—®å°±æˆäº† `2`ï¼Œä¸€èˆ¬æ—¶é—´åœ¨ä¸€ä¸¤ç§’ä»¥ä¸Šã€‚

[demo](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhutaod%2Ftest-next13 "https://github.com/hutaod/test-next13") å·¥ç¨‹æˆ‘éƒ¨ç½²åˆ°äº† vercelï¼Œå¯ä»¥ç‚¹å‡» [é¡µé¢](https://link.juejin.cn?target=https%3A%2F%2Ftest-next13-alpha.vercel.app%2Fisr%2Fdemo2 "https://test-next13-alpha.vercel.app/isr/demo2") å’Œ [æŒ‡ä»¤](https://link.juejin.cn?target=https%3A%2F%2Ftest-next13-alpha.vercel.app%2Fapi%2Frevalidate%3Fsecret%3DMY_SECRET_TOKEN "https://test-next13-alpha.vercel.app/api/revalidate?secret=MY_SECRET_TOKEN") ç›´æ¥å»éªŒè¯ï¼Œä¸è¿‡å› ä¸ºæ˜¯å¤–ç½‘ï¼Œæœ‰å¯èƒ½è®¿é—®ä¸äº†ã€‚

### ISR â€”â€” åŠ¨æ€è·¯ç”±

ä¸Šé¢çš„ä¸¤ä¸ªæ¡ˆä¾‹åªæ˜¯ä¸€ä¸ªå•é¡µé¢ï¼Œå¦‚æœæ˜¯åŠ¨æ€è·¯ç”±é¡µé¢ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥æ·»åŠ  `getStaticPaths` æ¥å®ç°ã€‚

demo3 åœ¨ demo2 çš„åŸºç¡€ä¸Šï¼Œä¿®æ”¹äº†ä¸€ä¸‹æ–‡ä»¶åå‘½åæ–¹å¼ï¼Œ`demo3/index.js` æ”¹æˆ `demo3/[id].js`ï¼Œå†…å®¹æ–°å¢ `getStaticPaths` å†…å®¹ï¼š

```
export async function getStaticPaths() {
  // ä»æ¥å£è·å–æ–‡ç« åˆ—è¡¨ï¼Œä½¿ç”¨çš„æ—¶å€™ä¸ç”¨æœ¬ç«™çš„æ¥å£ï¼Œè¿™æ ·åœ¨æ‰“åŒ…çš„æ—¶å€™ä¼šå‡ºé”™ã€‚
  const res = await fetch('http://localhost:3000/api/posts/list')
  const posts = await res.json()

  // å¤„ç†æˆ getStaticPaths éœ€è¦çš„è¿”å›å‚æ•°
  const paths = posts.map((post: any) => ({
    params: { id: post.id },
  }))
  
  return { paths, fallback: 'blocking' }
}
```

å¯¹åº”çš„ä¿®æ”¹ä¸€ä¸‹é¡µé¢å†…å®¹ï¼š

```
const Demo3 = ({ name, content }) => {
  return (
    <div>
      <h2>{name}</h2>
      <div dangerouslySetInnerHTML={{ __html: content }}></div>
    </div>
  )
}

export async function getStaticProps(ctx) {
  // è·å–è¯¦æƒ…
  const res = await fetch(`http://localhost:3000/api/posts/detail?id=${ctx.params?.id}`);
  const detail = await res.json()
  return {
    props: {
      ...detail
    }
  }
}
```

åœ¨ `src/pages/api/posts` ç›®å½•ä¸‹ç¼–å†™äº†ä¸¤ä¸ªç®€å•çš„æµ‹è¯•æ¥å£ï¼Œè¿™ä¸ªå¯ä»¥ç›´æ¥å»ä»£ç é‡Œé¢çœ‹ï¼Œä¹Ÿå¯ä»¥å¿½ç•¥ï¼Œå¹¶ä¸å½±å“ã€‚

ä¸‹é¢æ–°å¢åŠ¨æ€æŒ‡ä»¤ï¼š

```
// src/pages/api/revalidate/[id].js
export default async function revalidateHandler(req, res) {
  const { id } = req.query
  // ...çœç•¥

  try {
    // æ›´æ–° demo3
    await res.revalidate(`/isr/demo3/${id}`)
    // è¿”å›è¯´æ˜æ›´æ–°æŒ‡ä»¤å·²å‘å‡ºï¼Œå¹¶ä¸èƒ½è¯´æ˜ä¸€å®šæ›´æ–°æˆåŠŸ
    return res.json({ revalidated: true })
  } catch (err) {
    // æ›´æ–°å¤±è´¥
    return res.status(500).send('Error revalidating')
  }
}
```

ä½¿ç”¨ `getStaticPaths` æ¥è·å–éœ€è¦åŠ¨æ€ç”Ÿæˆçš„é¡µé¢æ—¶ï¼Œå¤§éƒ¨åˆ†åœºæ™¯å¯èƒ½ä¸éœ€è¦ä½¿ç”¨æ¥å£è¯·æ±‚è·å–åˆ—è¡¨ï¼Œä¸”ä¸èƒ½è¯·æ±‚æœ¬å·¥ç¨‹å®šä¹‰çš„ api æ¥å£ï¼Œå› ä¸ºåªä¼šåœ¨æ„å»ºè¿‡ç¨‹ä¸­æ‰§è¡Œï¼Œä½¿ç”¨æœ¬å·¥ç¨‹çš„ api ä¼šæŠ¥é”™ï¼Œè€Œä¸”è¿™é‡Œè¯·æ±‚æ¥å£ï¼Œå¦‚æœéœ€è¦ç”Ÿæˆçš„é¡µé¢è¿‡å¤šï¼Œä¼šå¯¼è‡´æ„å»ºå¾ˆæ…¢ï¼Œä¸€èˆ¬ç›´æ¥è¿”å› `{ paths: [], fallback: 'blocking' }` å³å¯ï¼Œè¿™æ ·åœ¨é¡µé¢ `é¦–æ¬¡è®¿é—®`ï¼ˆé¦–ä¸ªè®¿é—®é¡µé¢çš„ç”¨æˆ·è¿›è¡Œé¦–æ¬¡è®¿é—®æ—¶ä¼šæ¯”è¾ƒæ…¢ï¼‰ æˆ–è€…è¢«ä¸‹å‘ `revalidateæŒ‡ä»¤` æ—¶å°±å¯ä»¥ç”Ÿæˆé¡µé¢å†…å®¹ã€‚å¯ä»¥æ‰“å¼€ [demo3](https://link.juejin.cn?target=https%3A%2F%2Ftest-next13-alpha.vercel.app%2Fisr%2Fdemo3%2F333 "https://test-next13-alpha.vercel.app/isr/demo3/333")ï¼Œæˆ–è€…æœ¬åœ°æ‰“å¼€ [http://localhost:3000/isr/demo3/[id](https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000%2Fisr%2Fdemo3%2F%255Bid "http://localhost:3000/isr/demo3/%5Bid")] è¯•ä¸€ä¸‹ï¼ŒæŠŠ `[id]` æ›¿æ¢æˆä»€ä¹ˆæ•°å­—éƒ½å¯ä»¥ã€‚

æ³¨æ„äº‹é¡¹ï¼š

*   åŠ¨æ€è·¯ç”±ä¸»è¦éœ€è¦æ³¨æ„ [`fallback`](https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fapi-reference%2Fdata-fetching%2Fget-static-paths%23fallback-false "https://nextjs.org/docs/api-reference/data-fetching/get-static-paths#fallback-false") ï¼Œé»˜è®¤ä¸º false ï¼Œè¿™æ—¶ä»»ä½•æœªä½¿ç”¨ `paths` å­—æ®µè¿”å›çš„è·¯å¾„éƒ½å°†ä¼šæ˜¾ç¤º 404 é¡µé¢ï¼Œ`blocking` åˆ™å…è®¸ä¼ å…¥å…¶ä»–åŠ¨æ€è·¯ç”±å‚æ•°ï¼Œä¸€èˆ¬ä½¿ç”¨ `blocking` ã€‚
*   æ„å»ºæŒ‡ä»¤å¹¶ä¸ä¸€å®šéœ€è¦åŠ¨æ€æŒ‡ä»¤ï¼Œä¹Ÿå¯ä»¥å…¨éƒ¨é¡µé¢å…±ç”¨ä¸€ä¸ª `revalidateHandler` ï¼Œä½¿ç”¨ query å‚æ•°æ¥æ§åˆ¶ï¼Œæ ¹æ®å…·ä½“æƒ…å†µä½¿ç”¨å³å¯ï¼Œä½†å¿…é¡»æ³¨æ„å®‰å…¨æ€§é—®é¢˜ã€‚

éƒ¨ç½²é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ³•
------------

ç°åœ¨ä¸»è¦é‡åˆ°å¤šè¿›ç¨‹çš„ç–‘æƒ‘å’Œå¤šæœåŠ¡å™¨è´Ÿè½½å‡è¡¡çš„é—®é¢˜ï¼Œåç»­æœ‰æ›´å¤šé—®é¢˜ä¼šæ›´æ–°åˆ°æœ¬ç¯‡æ–‡ç« ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨â•ç‚¹èµğŸ‘â•æ”¶è—

### å¤šè¿›ç¨‹è´Ÿè½½å‡è¡¡çš„ç–‘æƒ‘

éƒ¨ç½²åˆ°çº¿ä¸Šæ˜¯ä½¿ç”¨ pm2 `cluster` æ¨¡å¼å¯åŠ¨ï¼Œå› æ­¤ä¼šå¯åŠ¨å¤šä¸ªè¿›ç¨‹ï¼Œç„¶åå°±è€ƒè™‘åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼š

> next æœåŠ¡å¯åŠ¨åï¼Œæ¯æ¬¡è®¿é—®é¡µé¢ï¼Œåˆ°äº† server ç«¯éƒ½æ˜¯åªä¼šè¢«åˆ†å‘åˆ°ä¸€ä¸ªè¿›ç¨‹å»å¤„ç†ï¼Œé¦–æ¬¡è®¿é—®å°±ä¼šåŠ¨æ€ç”Ÿæˆä¸€é¡µé¢çš„ html æ–‡ä»¶ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡è®¿é—®è¿›å…¥åˆ°äº†ç¬¬äºŒä¸ªè¿›ç¨‹ï¼Œè¿™é‡Œæ˜¯ä¸æ˜¯ä¼šè¯»å–ç£ç›˜å†…çš„ html å†…å®¹å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œç»è¿‡æˆ‘å¤šæ¬¡æµ‹è¯•éªŒè¯ï¼Œå†åŠ ä¸Šé˜…è¯»äº†å¯¹åº”çš„ç›¸å…³æºç ï¼Œç„¶åå¾—å‡ºäº†ä¸€ä¸ªç»“è®ºï¼š

> `ISR` ç”Ÿæˆ html æ–‡ä»¶åï¼Œé»˜è®¤å¹¶ä¸ä¼šè¯»å–å®ƒï¼Œå› ä¸ºå†™å…¥ç£ç›˜ä¹‹å‰ï¼Œå­˜å…¥åˆ°äº†å†…å­˜ä¸­ï¼Œä¹Ÿå°±æ˜¯åŠ äº†ä¸€ä¸ªå˜é‡è¿›è¡Œç¼“å­˜ html å­—ç¬¦ä¸²ã€‚

å¦‚æœè¿™æ—¶å€™å»æ‰‹åŠ¨æ”¹åŠ¨ `html` æ–‡ä»¶ï¼Œä¼šéªŒè¯ä¸Šé¢è¿™ä¸ªç»“è®ºã€‚

è€Œ `next` å¤šè¿›ç¨‹è¿™é‡Œçš„å¤„ç†æ–¹å¼ä¹Ÿå¾ˆæœ‰æ„æ€ï¼Œæ¯æ¬¡è®¿é—®æ–°çš„è¿›ç¨‹ï¼Œéƒ½ä¼šé‡æ–°å»ç”Ÿæˆä¸€æ¬¡ `html` æ–‡ä»¶ï¼Œä½†æ˜¯å½“æ¬¡çš„è®¿é—®è¯·æ±‚ä¼šè¿”å›æ—§çš„ç¼“å­˜é¡µé¢ï¼Œå¦‚æœæ²¡æœ‰æ—§çš„å†…å®¹æ‰è¿”å›æ–°çš„å†…å®¹ã€‚æ¯ä¸ªè¿›ç¨‹ç”Ÿæˆé¡µé¢åéƒ½ä¼šè¢«è®°å½•ï¼Œä¸‹æ¬¡è®¿é—®ä¸å†é‡ç°ç”Ÿæˆã€‚

### å¤šæœåŠ¡å™¨è´Ÿè½½å‡è¡¡æ€ä¹ˆå¤„ç†

å‰é¢å¾—å‡º `next` æœåŠ¡å¯åŠ¨åï¼Œä¸ä¼šå†è¯»å–ç£ç›˜çš„ `html` å†…å®¹ï¼Œä¹Ÿå°±æ˜¯å¦‚æœæ˜¯å¤šå°æœåŠ¡å™¨ï¼Œå°±ä¼šå‡ºç°è¿™æ ·ä¸€ä¸ª bugï¼š

> æ¯å°æœåŠ¡å™¨éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œç£ç›˜ä¸Šç”Ÿæˆçš„ `html` ä¼šå¯èƒ½ä¸ä¸€æ ·ï¼Œserver å†…å­˜ä¸­ç¼“å­˜çš„ `html` ä¹Ÿå¯èƒ½ä¸ä¸€æ ·ã€‚é‚£ä¹ˆå¯èƒ½å¤šæ¬¡è®¿é—®ï¼Œç”¨æˆ·æ˜¾ç¤ºçš„ç»“æœå´å¯èƒ½ä¸ä¸€æ ·ã€‚

é‚£æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæƒ³åˆ°äº†ä¸¤ç§è§£å†³æ–¹æ³•ï¼š

*   å¯¹é¡µé¢çš„ `æ›´æ–°æŒ‡ä»¤` è¿›è¡Œå¤šæœåŠ¡å™¨ä¸‹å‘ï¼Œå› ä¸ºæ›´æ–°æŒ‡ä»¤ä¸€èˆ¬é¢‘ç‡æ¯”è¾ƒå°‘ï¼Œå› æ­¤ä¸ä¼šé€ æˆæ€§èƒ½ä¸Šçš„é—®é¢˜ï¼Œä½†æ˜¯è¿™ç§åªèƒ½å¤„ç† `æŒ‡ä»¤æ›´æ–°` çš„æƒ…å†µ
*   å…±äº«ç£ç›˜â•ç¦ç”¨å†…å­˜ç¼“å­˜ï¼šnext æä¾›äº†é…ç½®å‚æ•°æ¥ç¦ç”¨ `ISR` ç¼“å­˜ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥å¤„ç†å„ç§æƒ…å†µï¼Œä½†æ˜¯æ€§èƒ½ç¨å¾®æœ‰ä¸€ç‚¹ç‚¹å½±å“ï¼Œä½†å½±å“å¹¶ä¸å¤§ï¼Œæ¯ä¸ª html å†…å®¹ä¹Ÿä¸ä¼šå¤ªå¤§

æ›´æ¨èç¬¬äºŒç§æ–¹å¼ï¼Œç¦ç”¨ç¼“å­˜çš„æ–¹æ³•ï¼š

```
module.exports = {
  experimental: {
    // é»˜è®¤æœ€å¤§ç¼“å­˜é™åˆ¶ä¸º 50MB
    isrMemoryCacheSize: 0,
  },
}
```

ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹[å®˜æ–¹æ–‡æ¡£è¯´æ˜](https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fbasic-features%2Fdata-fetching%2Fincremental-static-regeneration%23self-hosting-isr "https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration#self-hosting-isr")

æ€»ç»“
--

æœ¬æ–‡ä» `ISR` ä»‹ç»ã€ä½¿ç”¨ã€é‡åˆ°çš„é—®é¢˜ ä¸‰ä¸ªæ–¹é¢æ¥åˆ†æ `å¢é‡é™æ€åŒ–` ï¼Œå…¶ä¸­ä¹Ÿæ¶‰åŠåˆ°äº†ä¸€äº›åŸç†åˆ†æä»¥åŠéœ€è¦æ³¨æ„çš„äº‹é¡¹ï¼Œå¦‚æœæœ‰ä¸æ¸…æ¥šæ¬¢è¿è¯„è®ºåŒºè®¨è®ºã€‚

ä¸‹é¢å†æ€»ç»“ä¸€ä¸‹ä½¿ç”¨ `å¢é‡é™æ€åŒ–` çš„ä¸€äº›é—®é¢˜å’Œæ³¨æ„äº‹é¡¹ï¼š

1.  å¦‚æœç›´æ¥ä¿®æ”¹äº†é™æ€åŒ– `html` çš„å†…å®¹ï¼Œé‚£ä¹ˆè®¿é—®çš„æ—¶å€™é¡µé¢ä¼šå…ˆæ˜¾ç¤ºä¿®æ”¹åçš„å†…å®¹ï¼Œä½† next ä¼šè¿›è¡Œæ£€æµ‹é¡µé¢å†…å®¹æ˜¯å¦æ­£ç¡®ï¼Œä¸æ­£ç¡®ä¼šåˆ·æ–°é¡µé¢å†…å®¹ï¼Œä½†ä¸ä¼šçº æ­£ç£ç›˜å†…çš„ `html` æ–‡ä»¶ã€‚
2.  å¦‚æœä¿®æ”¹äº† `ISR` çš„é™æ€åŒ– `html` çš„å†…å®¹ï¼Œé‚£ä¹ˆé¦–æ¬¡è®¿é—®æ—¶ï¼Œä¹Ÿä¼šå‡ºç°ä¸Šé¢é‚£ä¸ªåˆ·æ–°é¡µé¢ç°è±¡ï¼Œè¿™æ—¶ä¼šç”Ÿæˆæ–°çš„ `html` è¿˜ä¼šçº æ­£ç£ç›˜å†…çš„ `html` æ–‡ä»¶ï¼Œä½†æ˜¯å†æ¬¡å»ä¿®æ”¹ `html` æ—¶ï¼Œä¸ä¼šå‡ºç°åˆ·æ–°é¡µé¢ç°è±¡ï¼Œä½†å¦‚æœè®¿é—®çš„æ˜¯è¿˜æœªè®¿é—®çš„æ–°è¿›ç¨‹ï¼Œä¼šçº æ­£ç£ç›˜å†…çš„ `html` æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ä¸æ˜¯é¦–æ¬¡è®¿é—®æ—¶ï¼Œå°±æ°¸è¿œä¸ä¼šçº æ­£
3.  ç¬¬ 2 ç§æƒ…å†µï¼Œå¦‚æœç¦ç”¨ `ISR` ç¼“å­˜çš„è¯ï¼Œæ¯ä¸ªè¿›ç¨‹çš„é¦–æ¬¡ä¼šçº æ­£ç£ç›˜å†…çš„ `html` æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ä¸æ˜¯é¦–æ¬¡è®¿é—®æ—¶ï¼Œå°±æ°¸è¿œä¸ä¼šçº æ­£ã€‚ä½†è¿˜æ˜¯ä¼šåˆ·æ–°é¡µé¢å†…å®¹ã€‚
4.  ä¸ç®¡æ˜¯å®šæ—¶è¿˜æ˜¯æŒ‡ä»¤æ–¹å¼ï¼Œå½“å‘å‡ºè¯·æ±‚è®©é¡µé¢è¿›è¡Œæ„å»ºæ—¶ï¼Œå®ƒéƒ½ä¼šå…ˆè¿”å›ç¼“å­˜é¡µé¢ã€‚
5.  `fallback` æ›´å»ºè®®è®¾ç½®ä¸ºÂ `blocking`Â ï¼Œé˜²æ­¢æ„å»ºæ—¶é—´è¿‡é•¿ã€‚
6.  `pm2` å¤šè¿›ç¨‹å¯åŠ¨é¡¹ç›®ä¸ç”¨æ‹…å¿ƒæ¯ä¸ªè¿›ç¨‹è¿”å›ç»“æœä¸ä¸€æ ·ï¼Œ`next` å†…éƒ¨å·²ç»è¿›è¡Œå¤„ç†
7.  å¤šæœåŠ¡å™¨è´Ÿè½½æ—¶ï¼Œå»ºè®®ä½¿ç”¨ `å…±äº«ç£ç›˜â•ç¦ç”¨å†…å­˜ç¼“å­˜` ä¼šæ›´å¥½ã€‚

> åˆ›ä½œä¸æ˜“ï¼Œæ¬¢è¿å…³æ³¨â•è¯„è®ºâ•ç‚¹èµğŸ‘â•æ”¶è—ï¼Œæ„Ÿè°¢ğŸ™