> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [juejin.cn](https://juejin.cn/post/7204085076504920119)

客户端渲染（CSR）
----------

### 什么是客户端渲染呢？

服务器直接转发静态 html 资源即可。

常见的形式就是：
打包的时候生成只有 css、js 等外链标签的空白页面，
客户端在请求时，服务端不做任何处理，直接以原文件的形式返回给客户端客户端，
客户端获取到页面后，在加载完 js 后才通过 js 来渲染页面内容。

服务端渲染（SSR）
----------

这里主要说的是传统的服务端渲染，现代的服务端渲染指的是同构渲染。
客户端渲染就是 `data + template = html` 过程在服务端进行，客户端不需要渲染页面。

具体解释就是：服务端渲染的模式下，当用户第一次请求页面时，由服务器把需要的组件或页面渲染成 HTML 字符串，然后把它返回给客户端。

什么是同构渲染？
--------

### 何为同构？
同构是指写一份代码但可同时在浏览器和服务器中运行的应用。为了同时拥有 ssr 和 csr 的特点，当前流行的方案就是 ssr + csr 同构，比如现在比较流行的的 Next.js。

而同构渲染也就是指：在服务端先进行渲染一次（SSR，组装页面 html 内容），客户端拿到代码后，再进行渲染一次（CSH（client-side hydration），也就是 hydrate，主要对 html 进行事件绑定和内容校验，如果 hydrate 发现内容不一致的话，会在开发环境提示警告），后续页面的所有操作和渲染行为都和 CSR 一致（didMount 后的更新页面内容都属于正常的 CSR 了）。

### 认识同构

同构应用运行原理的核心在于虚拟 DOM，虚拟 DOM 的优点在于：

1.  因为操作 DOM 树是高耗时的操作，尽量减少 DOM 树操作能优化网页性能。而 DOM Diff 算法能找出 2 个不同 Object 的最小差异，得出最小 DOM 操作;
2.  虚拟 DOM 的在渲染的时候不仅仅可以通过操作 DOM 树来表示结果，也能有其他的表示方法。例如虚拟 DOM 渲染成字符串（服务器渲染）等。

构建同构应用的最终目的是从一份项目源码中构建出 2 份 JavaScript 代码。一份用于在 node 环境中运行渲染出 HTML。其中用于在 node 环境中运行的 JavaScript 代码需要注意：

1.  不能包含浏览器环境提供的 API；
2.  不建议包含 css 代码，因为服务端渲染的目的是渲染 html 内容， 渲染出 css 代码会增加额外的计算量，影响服务端渲染，因此建议 css 需要用外联方式；
3.  不能像用于浏览器环境的输出代码那样把 node_modules 里的第三方模块和 nodejs 原生模块打包进去，而是需要分开进行打包，客户端打包一份和服务端打包一份，或者打包的时候区分各自运行的文件。

扩展渲染模式
------

上面说的渲染模式属于基础渲染模式，现在还有了更多的渲染模式，且运用都很广泛。
1.  静态化渲染：打包的时候进行 `data + template = html` 过程，然后客户端在请求时，服务端不做任何处理，直接以原文件的形式返回给客户端，客户端获取到也没可以正常显示页面后再去执行 js 内容。
2.  增量静态渲染：之前有一篇文章专门介绍了 [ISR 渲染模式](https://juejin.cn/post/7199812069050171452 "https://juejin.cn/post/7199812069050171452")，可以去看一下。
